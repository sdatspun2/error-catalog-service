# Error Discovery Service

Error Discovery Service API provides operations to discover and manage metadata related to errors that are associated with HTTP APIs. 

## Need

Following are some of the reasons to use Error Discovery Service.

#### Externalize error messages

Often error descriptions emitted by APIs are written by developers and make a lot of assumptions about the context and the audience. It is hard to change such descriptions if these are hardcoded in implementation of services that expose the APIs. For example, to change a message from "Add Card refused due to compliance guidelines" to "Could not add card due to failure to comply with guideline %s", a developer has to make change(s) in the code and redeploy the service(s).

#### Service interface language specification does not accommodate error details 

The [OpenAPI](https://swagger.io/specification/) Specification (OAS) defines a standard, language-agnostic interface to RESTful APIs which allows both humans and computers to discover and understand the capabilities of the service without access to source code, documentation, or through network traffic inspection. When properly defined, a consumer can understand and interact with the remote service with a minimal amount of implementation logic. OAS stops short of defining a list of errors that various operations of the service interface can emit.

#### Increased support cost

It is observed that often there is non-trivial hidden cost of supporting consumers of API navigate error scenarios. There could be various reasons such as errors are not documented well, error description is confusing or incorrect, API portals do not list errors in a comprehensive fashion, not enough testing is done for error scenarios to validate if operations exposed by APIs are emitting proper and legible errors.

#### Error documentation is out of sync with error handling at runtime

API consumers should be able to refer with confidence the API's documentation for errors generated by the services. This helps to reduce the cost and the time spent supporting an API and increases adoptability of the API.

#### Localize the error message strings 
If error related strings such as message, description, actions to take, etc. are externalized, it is easy for the documentation and an internationalization teams to modify and localize these without any help from the service developers and without requiring redeployment of the services.

## Terms Used


#### Domain

According to Wikipedia, a domain model is a system of abstractions that describes selected aspects of a sphere of knowledge, influence, or activity. The concepts include the data involved in a business, and the rules that the business uses in relation to that data. As an example, a fintech domain model includes domains such as Payment, Risk, Compliance, Identity, Customer Support, etc.

#### Resource

The key abstraction of information in REST is a resource. A [resource](https://github.com/paypal/api-standards/blob/master/api-style-guide.md#resource) is a conceptual mapping to a set of entities, not the entity that corresponds to the mapping at any particular point in time. More precisely, a resource R is a temporally varying membership function MR(t), that for time t maps to a set of entities, or values, that are equivalent. The values in the set may be resource representations and/or resource identifiers.

#### Microservice 

Microservices (aka Service) provides a generic Application Programming Interface (API) for accessing and manipulating the value set of a resource, regardless of how the membership function is defined or the type of software that is handling the request.

#### Namespace

Capabilities drive service modeling and namespace concerns in an API portfolio. Namespaces are part of the Business Capability Model. Examples of namespace are: identity, compliance, settlements, transfers, credit, payments, etc.


## Use Cases


1. Microservices providing APIs can retrieve error metadata from the Error Discovery Service instead of hard-coding in the code.
2. API Portal can show a list of errors and error details associated with an API using using the API definition and [the Error Discovery Service.
3. Automation tests for an API can verify errors emitted by services using the API definition and the Error Discovery Service.


## API

API definition for Error Discovery Service is defined using OpenAPI Document which is available [here](error_discovery_service.json). 

### Resources of Error Discovery Service

There are two resources in Error Discovery Service.

1. Error Metadata
2. Error Catalog

#### Error Metadata

Error Metadata describes an error. An Error Metadata can be associated with one or more operations that belong to one or more APIs. Metadata includes an identifier for the error, a message (if required, a templatized string), HTTP status code(s) that would be used to inform about this error and it describes possible action(s) to take in order to rectify the error.

#### Error Catalog

An Error Catalog has a namespace, language and a collection of error metadata for the namespace. There SHOULD be an Error Catalog for a default language (e.g. `en_US`). There chould be one or more language-specific catalog as needed.

## Custom Extensions for OpenAPI Specification

[OpenAPI](https://swagger.io/specification/) Specification allows [extensions](https://swagger.io/specification/#specification-extensions). For Error Discovery Service, we have identified two extensions. Using an [OpenAPI Document](https://swagger.io/specification/#definitions) that is annotated with these 2 extensions, various tool/components/systems including but not limited to API portal, microservice exposing the API, CI/CD utilities and QA tests can retrieve error metadata from one or more error catalog(s) with the help of Error Discovery Service. 

1. `x-error-namespaces`
2. `x-error-ids`

### `x-error-namespaces`

This extension lists an array of namespace(s) where the errors that are associated with an API can be found. An [OpenAPI Document](https://swagger.io/specification/#definitions) SHOULD be annotated with this extension.

#### Example

The following example indicates that errors emitted by one or more operation(s) of an API belong to error catalogs for `generic` and `issuance` namespaces.

```
"x-error-namespaces":["generic", "issuance"]
```

### `x-error-ids`

This extension lists an array of error metadata related to the errors emitted by operations that are annotated using this extension. 

#### Example

The following example indicates that errors emitted by an operation(s) annotated using this extension are identified using given identifiers: `resource_not_found`, `card_type_invalid`, `brand_invalid`, `last4_invalid` and `expiry_invalid` in namespaces listed in `x-error-namespaces`.

```
"x-error-ids": ["resource_not_found", "card_type_invalid", "brand_invalid", "last4_invalid", "expiry_invalid"]
```

The API definition for Error Discovery Service is annotated with `x-error-namespaces` and `x-error-ids` extensions.


## Credit
1. [Error Catalog - PayPal Design Guidelines](https://github.com/paypal/api-standards/blob/master/api-style-guide.md#error-catalog)
